enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
number_of_fish=20
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
fish_frame_with_survival_from_length
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_frame_with_survival_from_length
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
cells_traversed
joined_fish_cell_traversed
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_proportion_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
default_base_pred_success <- 0.6
default_reach_pred_min <- 1 - default_base_pred_success
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_proportion_of_survivors(fish_summary_frame, num_trans)
calculat_proportion_of_survivors <- function(number_of_survivors, number_of_fish){
number_of_survivors / number_of_fish
}
number_of_survivors <- calculate_proportion_of_survivors(fish_summary_frame, num_trans)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
proprtion_of_survivors
survival_simulation_driver <- function(number_of_fish){
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
}
survival_simulation_driver(10)
prop <- survival_simulation_driver(10)
survival_simulation_driver <- function(number_of_fish){
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
}
print(survival_simulation_driver(100))
print(survival_simulation_driver(100))
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
default_base_pred_success <- 0.6
default_reach_pred_min <- 1 - default_base_pred_success
survival_table <- predation_survival_driver_func()
num_trans <- calculate_num_trans_traversed()
calculate_num_trans_traversed <- function(transect_length=default_transect_length,
n_transects=default_n_transects,
grid_size=default_grid_size){
round(default_transect_length * default_n_transects / default_grid_size)
}
get_enc_prob_vector <- function(enc_prob_dataframe){
enc_prob_dataframe %>% pull(enc_prob)
}
randomly_sample_encounter_probs <- function(enc_probs, num_trans_traversed){
sample(enc_probs, num_trans_traversed)
}
calcule_risk_modifier <- function(survival_table, selected_variable, variable_magnitude){
#var <-  selected_variable
survival_table %>%
filter(variable == as.character(selected_variable) & x == as.character(variable_magnitude)) %>%
pull(survival)
}
set_up_dataframe_of_fish_lengths <- function(number_of_fish, mean = 20, sd = 4, precision = 1){
vals <- round(rnorm(2*number_of_fish, mean, sd), precision)
vals <- vals[vals>0][1:number_of_fish]
data.frame(fish = (seq(number_of_fish)), length = vals)
}
calculate_encounter_prob_based_on_length <- function(fish_length_boost, enc_prob){
encounter_check_values <- (1- fish_length_boost) * enc_prob
}
check_if_encounter_occurs <- function(encounter_prob_based_on_length){
encounter <- sample(c(0, 1), size = 1, prob = c(1 - encounter_prob_based_on_length, encounter_prob_based_on_length))
}
evaluate_encounter <- function(pred_success = default_base_pred_success, pred_min = default_reach_pred_min){
survival <- sample(c(0,1), 1, prob = c(pred_success, pred_min))
if(survival == 1.0){
outcome <- 1.0
} else {
outcome <- 0
}
}
encounter_simulator <- function(encounter_occurrence){
if(encounter_occurrence == 1){
outcome <- evaluate_encounter()
} else {
outcome <- 1
}
return(outcome)
}
encounter_frame <- function(fish_number, enc_prob_vector, num_trans_traversed){
data.frame(fish = fish_number, enc_prob = randomly_sample_encounter_probs(enc_prob_vector, num_trans_traversed))
}
add_length_survival_boost <- function(fish_frame, surv_table){
fish_frame %>%
mutate(survival_boost = lapply(length, FUN = calcule_risk_modifier, survival_table = surv_table, selected_variable = 'length'))
}
create_frame_of_all_cells_traversed_per_fish <- function(fish_vector, enc_prob_vector, num_trans_traversed){
df <- bind_rows(lapply(fish_frame$fish,
FUN = encounter_frame,
enc_prob_vector,
num_trans_traversed))
}
combine_encounter_frame_and_fish_frame <- function(fish_frame, enc_frame){
inner_join(fish_frame, enc_frame, by = 'fish')
}
add_encounter_simulation_columns <- function(combined_frame){
combined_frame%>%
mutate(survival_boost = as.numeric(survival_boost),
enc_prob = as.numeric(enc_prob),
modified_enc = calculate_encounter_prob_based_on_length(survival_boost, enc_prob),
encounter = lapply(modified_enc, check_if_encounter_occurs),
alive = as.numeric(lapply(encounter, encounter_simulator)))
}
evaluate_final_status_of_fish <- function(outcome_total, num_trans_traversed){
if(outcome_total < num_trans_traversed){
final_status <- 0
} else {
final_status <- 1
}
return(as.numeric(final_status))
}
sum_encounter_outcomes <- function(df){
df %>%
group_by(fish) %>%
summarize(total_alive_outcomes = sum(as.numeric(alive)))
}
calculate_number_of_survivors <- function(fish_summary_frame, num_trans_traversed){
fish_summary_frame %>%
mutate(final_status = lapply(total_alive_outcomes, FUN = evaluate_final_status_of_fish, num_trans_traversed)) %>%
unnest(final_status) %>%
summarize(num_surviving = sum(final_status))
}
calculat_proportion_of_survivors <- function(number_of_survivors, number_of_fish){
number_of_survivors / number_of_fish
}
survival_simulation_driver <- function(number_of_fish){
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
}
print(survival_simulation_driver(100))
survival_simulation_driver <- function(number_of_fish){
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
#proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
}
print(survival_simulation_driver(100))
survival_simulation_driver <- function(number_of_fish){
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
}
set_up_dataframe_of_fish_lengths <- function(number_of_fish, mean = 30, sd = 4, precision = 1){
vals <- round(rnorm(2*number_of_fish, mean, sd), precision)
vals <- vals[vals>0][1:number_of_fish]
data.frame(fish = (seq(number_of_fish)), length = vals)
}
print(survival_simulation_driver(100))
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
number_of_fish=10
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
fish_frame_with_survival_from_length
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
cells_traversed
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
proprtion_of_survivors
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
number_of_fish=100
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
proprtion_of_survivors
set_up_dataframe_of_fish_lengths <- function(number_of_fish, mean = 20, sd = 4, precision = 1){
vals <- round(rnorm(2*number_of_fish, mean, sd), precision)
vals <- vals[vals>0][1:number_of_fish]
data.frame(fish = (seq(number_of_fish)), length = vals)
}
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
number_of_fish=100
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
proprtion_of_survivors
survival_simulation_driver <- function(number_of_fish){
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
#number_of_fish=100
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
}
print(survival_simulation_driver(100))
calculat_proportion_of_survivors <- function(number_of_survivors, number_of_fish){
proportion_of_survivors <- number_of_survivors / number_of_fish
}
survival_simulation_driver <- function(number_of_fish){
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
#number_of_fish=100
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
}
print(survival_simulation_driver(100))
valsurvival_simulation_driver(10)
val <- survival_simulation_driver(10)
val
val[1]
val[[10]]
val[[1]]
calculat_proportion_of_survivors <- function(number_of_survivors, number_of_fish){
proportion_of_survivors <- number_of_survivors[[1]] / number_of_fish
}
survival_simulation_driver <- function(number_of_fish){
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
#number_of_fish=100
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
}
print(survival_simulation_driver(100))
set_up_dataframe_of_fish_lengths <- function(number_of_fish, mean = 12, sd = 4, precision = 1){
vals <- round(rnorm(2*number_of_fish, mean, sd), precision)
vals <- vals[vals>0][1:number_of_fish]
data.frame(fish = (seq(number_of_fish)), length = vals)
}
survival_simulation_driver <- function(number_of_fish){
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
}
print(survival_simulation_driver(100))
library("rstudioapi")
library('tidyverse')
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
source('generate_preds.R')
source('main.R')
# set-up values
# pred_pos <- get_pred_postitions()
# stream_grid_frame <- create_stream_raster_frame(pred_pos)
# enc_probs <- calc_enc_probs(stream_grid_frame)
default_base_pred_success <- 0.6
default_reach_pred_min <- 1 - default_base_pred_success
# survival_table <- predation_survival_driver_func()
# num_trans <- calculate_num_trans_traversed()
calculate_num_trans_traversed <- function(transect_length=default_transect_length,
n_transects=default_n_transects,
grid_size=default_grid_size){
round(default_transect_length * default_n_transects / default_grid_size)
}
get_enc_prob_vector <- function(enc_prob_dataframe){
enc_prob_dataframe %>% pull(enc_prob)
}
randomly_sample_encounter_probs <- function(enc_probs, num_trans_traversed){
sample(enc_probs, num_trans_traversed)
}
calcule_risk_modifier <- function(survival_table, selected_variable, variable_magnitude){
#var <-  selected_variable
survival_table %>%
filter(variable == as.character(selected_variable) & x == as.character(variable_magnitude)) %>%
pull(survival)
}
set_up_dataframe_of_fish_lengths <- function(number_of_fish, mean = 12, sd = 4, precision = 1){
vals <- round(rnorm(2*number_of_fish, mean, sd), precision)
vals <- vals[vals>0][1:number_of_fish]
data.frame(fish = (seq(number_of_fish)), length = vals)
}
calculate_encounter_prob_based_on_length <- function(fish_length_boost, enc_prob){
encounter_check_values <- (1- fish_length_boost) * enc_prob
}
check_if_encounter_occurs <- function(encounter_prob_based_on_length){
encounter <- sample(c(0, 1), size = 1, prob = c(1 - encounter_prob_based_on_length, encounter_prob_based_on_length))
}
evaluate_encounter <- function(pred_success = default_base_pred_success, pred_min = default_reach_pred_min){
survival <- sample(c(0,1), 1, prob = c(pred_success, pred_min))
if(survival == 1.0){
outcome <- 1.0
} else {
outcome <- 0
}
}
encounter_simulator <- function(encounter_occurrence){
if(encounter_occurrence == 1){
outcome <- evaluate_encounter()
} else {
outcome <- 1
}
return(outcome)
}
encounter_frame <- function(fish_number, enc_prob_vector, num_trans_traversed){
data.frame(fish = fish_number, enc_prob = randomly_sample_encounter_probs(enc_prob_vector, num_trans_traversed))
}
add_length_survival_boost <- function(fish_frame, surv_table){
fish_frame %>%
mutate(survival_boost = lapply(length, FUN = calcule_risk_modifier, survival_table = surv_table, selected_variable = 'length'))
}
create_frame_of_all_cells_traversed_per_fish <- function(fish_vector, enc_prob_vector, num_trans_traversed){
df <- bind_rows(lapply(fish_frame$fish,
FUN = encounter_frame,
enc_prob_vector,
num_trans_traversed))
}
combine_encounter_frame_and_fish_frame <- function(fish_frame, enc_frame){
inner_join(fish_frame, enc_frame, by = 'fish')
}
add_encounter_simulation_columns <- function(combined_frame){
combined_frame%>%
mutate(survival_boost = as.numeric(survival_boost),
enc_prob = as.numeric(enc_prob),
modified_enc = calculate_encounter_prob_based_on_length(survival_boost, enc_prob),
encounter = lapply(modified_enc, check_if_encounter_occurs),
alive = as.numeric(lapply(encounter, encounter_simulator)))
}
evaluate_final_status_of_fish <- function(outcome_total, num_trans_traversed){
if(outcome_total < num_trans_traversed){
final_status <- 0
} else {
final_status <- 1
}
return(as.numeric(final_status))
}
sum_encounter_outcomes <- function(df){
df %>%
group_by(fish) %>%
summarize(total_alive_outcomes = sum(as.numeric(alive)))
}
calculate_number_of_survivors <- function(fish_summary_frame, num_trans_traversed){
fish_summary_frame %>%
mutate(final_status = lapply(total_alive_outcomes, FUN = evaluate_final_status_of_fish, num_trans_traversed)) %>%
unnest(final_status) %>%
summarize(num_surviving = sum(final_status))
}
calculat_proportion_of_survivors <- function(number_of_survivors, number_of_fish){
proportion_of_survivors <- number_of_survivors[[1]] / number_of_fish
}
survival_simulation_driver <- function(number_of_fish){
num_trans <- calculate_num_trans_traversed()
pred_pos <- get_pred_postitions()
stream_grid_frame <- create_stream_raster_frame(pred_pos)
enc_probs <- calc_enc_probs(stream_grid_frame)
enc_prob_vector <- get_enc_prob_vector(enc_probs)
surv_table <- predation_survival_driver_func()
fish_frame <- set_up_dataframe_of_fish_lengths(number_of_fish)
fish_frame_with_survival_from_length <- add_length_survival_boost(fish_frame,surv_table)
cells_traversed <- create_frame_of_all_cells_traversed_per_fish(fish_frame_with_survival_from_length$fish, enc_prob_vector, num_trans)
joined_fish_cell_traversed <- combine_encounter_frame_and_fish_frame(fish_frame_with_survival_from_length, cells_traversed)
joined_frame_with_sim_cols <- add_encounter_simulation_columns(joined_fish_cell_traversed)
fish_summary_frame <- sum_encounter_outcomes(joined_frame_with_sim_cols)
number_of_survivors <- calculate_number_of_survivors(fish_summary_frame, num_trans)
proprtion_of_survivors <- calculat_proportion_of_survivors(number_of_survivors, number_of_fish)
}
print(survival_simulation_driver(100))
s <- survival_simulation_driver(10)
create_frame_of_all_cells_traversed_per_fish <- function(fish_vector, enc_prob_vector, num_trans_traversed){
df <- bind_rows(lapply(fish_vector,
FUN = encounter_frame,
enc_prob_vector,
num_trans_traversed))
}
s <- survival_simulation_driver(10)
s
s <- survival_simulation_driver(100)
s
set_up_dataframe_of_fish_lengths <- function(number_of_fish, mean = 30, sd = 4, precision = 1){
vals <- round(rnorm(2*number_of_fish, mean, sd), precision)
vals <- vals[vals>0][1:number_of_fish]
data.frame(fish = (seq(number_of_fish)), length = vals)
}
s <- survival_simulation_driver(100)
s
set_up_dataframe_of_fish_lengths <- function(number_of_fish, mean = 20, sd = 4, precision = 1){
vals <- round(rnorm(2*number_of_fish, mean, sd), precision)
vals <- vals[vals>0][1:number_of_fish]
data.frame(fish = (seq(number_of_fish)), length = vals)
}
s <- survival_simulation_driver(100)
s
